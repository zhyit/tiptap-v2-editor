<script setup>
import {useI18n} from "vue-i18n";
import {ref} from "vue";
import ZColorSel from "../../color/ZColorSel.vue";
import ZIcon from "../../ZIcon.vue";

const {t} = useI18n()
const props = defineProps({
  editor: {
    type: Object,
    required: true
  },
  color: {
    type: String,
    default: 'currentColor'
  }
})
const groupVisible = ref(false)
const colorVal = ref('#000000')

const handle_click = () => {
  groupVisible.value = !groupVisible.value
}
const handle_close_group = () => {
  groupVisible.value = false
}
const handle_color_sel = (color) => {
  props.editor.chain().focus().toggleHighlight({color}).run()
  handle_close_group()
}
const handle_color_clear = () => {
  props.editor.chain().focus().unsetHighlight().run()
  handle_close_group()
}
</script>

<template>
  <div class="tiptap-btn-icon-box" v-click-outside="handle_close_group">
    <z-icon :title="t('editor.toolbar.highlight')" @click="handle_click" :active.sync="editor?.isActive('highlight')">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="24" height="24" class="tiptap-btn-icon">
        <path d="M211.26578,79.13065c-0.00024-0.00018-0.00043-0.00043-0.00067-0.00061
	c-3.49927-3.49896-9.17242-3.49866-12.67133,0.00061l-43.28961,43.28961l-55.29601-55.29602l25.72803-25.72803
	c3.49926-3.49927,3.49926-9.17267,0-12.672c-3.49933-3.49927-9.17273-3.49927-12.672,0L81.02573,60.77542
	c-0.00018,0.00024-0.00043,0.00043-0.00061,0.00067c-1.53754,1.53766-2.39813,3.49518-2.58435,5.50348
	c-0.03931,0.34064-0.06464,0.68549-0.06464,1.03668c0,21.82397-11.17438,56.1792-34.30396,85.0816
	c-0.13263,0.16583-0.24908,0.33905-0.3681,0.51111c-0.02582,0.03729-0.05414,0.07257-0.07941,0.11023
	c-0.12885,0.19244-0.245,0.38953-0.35718,0.5885c-0.03223,0.05701-0.06708,0.11218-0.09802,0.16998
	c-0.10443,0.19513-0.19702,0.39374-0.28577,0.59399c-0.03021,0.06799-0.06293,0.13434-0.09149,0.20325
	c-0.08167,0.19745-0.15204,0.3974-0.21881,0.59863c-0.02612,0.07843-0.05481,0.15552-0.07886,0.23486
	c-0.06073,0.20148-0.11011,0.40479-0.15625,0.60895c-0.01892,0.08337-0.04071,0.16534-0.05725,0.24951
	c-0.04126,0.21063-0.07062,0.42218-0.09656,0.63434c-0.01013,0.08221-0.02393,0.16315-0.0318,0.24597
	c-0.02124,0.22498-0.02954,0.45007-0.03381,0.67542c-0.00128,0.06244-0.00928,0.12305-0.00928,0.18579
	c0,0.01306,0.00189,0.0257,0.00195,0.03876c0.00134,0.21875,0.01617,0.43671,0.03339,0.6546
	c0.00647,0.08398,0.00714,0.16943,0.01593,0.25281c0.01764,0.16437,0.04834,0.32684,0.07501,0.49005
	c0.16278,1.00488,0.48285,1.95679,0.95038,2.82007c0.00092,0.00159,0.00146,0.0033,0.00232,0.00488
	c0.1394,0.25708,0.29065,0.50677,0.45374,0.74792c0.02185,0.03229,0.04816,0.06207,0.07043,0.09412
	c0.14459,0.20789,0.29443,0.4118,0.45563,0.60632c0.04266,0.05139,0.09174,0.09863,0.13568,0.14917
	c0.15106,0.17419,0.30457,0.34613,0.46851,0.50818c0.04126,0.04065,0.08734,0.07764,0.12952,0.11761
	c0.17615,0.16748,0.3562,0.33051,0.54547,0.48334c0.00916,0.00739,0.01697,0.01581,0.02618,0.02319
	c0.04413,0.03528,0.09137,0.0636,0.13593,0.0979c0.18256,0.14075,0.3678,0.27753,0.56104,0.40405
	c0.07489,0.04907,0.15216,0.09186,0.22803,0.13843c0.17401,0.10669,0.34906,0.21118,0.53064,0.30609
	c0.09302,0.04865,0.18799,0.09064,0.28217,0.13574c0.16858,0.08069,0.33746,0.1601,0.51172,0.23035
	c0.10687,0.04309,0.21527,0.07941,0.3233,0.11816c0.16522,0.05933,0.33026,0.11798,0.49982,0.16772
	c0.12061,0.03534,0.24225,0.06323,0.36377,0.09338c0.15997,0.03967,0.31934,0.07983,0.48254,0.11078
	c0.13788,0.02618,0.27643,0.04346,0.41498,0.06311c0.14978,0.02118,0.29846,0.04462,0.45056,0.05829
	c0.1601,0.01447,0.32019,0.01819,0.48053,0.02405c0.11212,0.00409,0.22192,0.01685,0.33502,0.01678h35.66077
	c1.76691,0.0014,3.49481-0.51965,4.96643-1.49762c4.54401-3.03363,12.9408-5.76001,24.51196-8.57599
	c5.12-1.25439,10.58563-2.44482,16.25603-3.6864l1.51038-0.32001c6.1568-1.36963,12.53119-2.77765,18.71362-4.3136
	c1.58032-0.39532,3.02301-1.21405,4.17279-2.36804l54.40002-54.39996c0.00018-0.00024,0.00043-0.00043,0.00061-0.00067
	C214.76529,88.3027,214.76505,82.62955,211.26578,79.13065z M130.13937,135.37387l-1.53601,0.33276
	c-5.61919,1.24164-11.27679,2.48322-16.62719,3.776c-10.08643,2.44482-20.3136,5.36322-27.75043,9.56158H68.57609
	c13.4801-20.71765,22.13208-42.96191,25.76447-62.26416l46.24133,46.25885
	C137.13467,133.83029,133.64493,134.60043,130.13937,135.37387z" :fill="color"/>
        <path d="M211,229.90024H45c-6.6,0-12-5.39999-12-12v-14.40001c0-6.60001,5.4-12,12-12h166c6.60001,0,12,5.39999,12,12
	v14.40001C223,224.50024,217.60001,229.90024,211,229.90024z" :fill="colorVal ? colorVal : color"/>
      </svg>
    </z-icon>
    <div class="tiptap-btn-group" v-if="groupVisible">
      <z-color-sel @clear="handle_color_clear" @sel="handle_color_sel" v-model="colorVal"/>
    </div>
  </div>
</template>

<style scoped>
@import "../../../assets/css/index.css";
</style>